# ---------
# BEHAVIOUR
# ---------

# Window manipulation.
focus_follows_mouse no

# Workspace names.
set {
    $www   1:www
    $code  2:code
    $cmd   3:cmd
    $chat  4:chat
    $media 5:media
    $games 6:games
    $misc  7:misc
}

# Mode aliases.
set {
    $resize  "Resize Window"
    $session "Session: Ⓢ Suspend, Ⓛ Logout, Ⓡ Reboot, Ⓟ Power off"
}

# Application aliases.
set {
    $terminal alacritty
    $launcher rofi -terminal $terminal -run-command 'bash -ic "{cmd}"'
    $locker   swaylock -f
    $player   playerctl
    $notify   dunstctl
    $mixer    pulsemixer --max-volume 100
}

# Display output configuration.
output * {
    scale    1
    subpixel none
}

bindswitch --reload --locked {
    lid:on output eDP-1 disable
    lid:off output eDP-1 enable
}

# Input configuration.
input "type:keyboard" {
    xkb_layout   us,gr
    xkb_options  grp:caps_toggle,grp_led:caps
    repeat_delay 400
    repeat_rate  80
}

input "type:touchpad" {
    tap            enabled
    natural_scroll enabled
}

input "type:pointer" {
    accel_profile adaptive
    pointer_accel 0.5
}

# Hide cursor after 30 seconds of inactivity.
seat * hide_cursor 30000

# Idle state management.
exec swayidle -w \
     timeout 300 '$locker' \
     timeout 420 'swaymsg "output * dpms off"' \
          resume 'swaymsg "output * dpms on"' \
    before-sleep '$locker' \
            lock '$player pause' \
            lock '$notify set-paused true' \
          unlock '$player pause' \
          unlock '$notify set-paused false'

# Inhibit idle tracking for specific applications.
for_window {
    [class="^.*"]  inhibit_idle fullscreen
    [app_id="^.*"] inhibit_idle fullscreen
}

# -----------
# KEYBINDINGS
# -----------

# Default modifier key is the 'Super' key.
set $mod Mod4

# Resize floating windows with modifider + mouse.
floating_modifier $mod

bindsym --to-code {
    # Application launching
    $mod+Return  exec $terminal
    $mod+d       exec $launcher -show drun -show-icons
    $mod+Shift+d exec $launcher -show run
    $mod+s       exec $launcher -show filebrowser -show-icons

    # Change focus
    $mod+h     focus left
    $mod+j     focus down
    $mod+k     focus up
    $mod+l     focus right
    $mod+Left  focus left
    $mod+Down  focus down
    $mod+Up    focus up
    $mod+Right focus right

    # Move focused window
    $mod+Shift+h     move left
    $mod+Shift+j     move down
    $mod+Shift+k     move up
    $mod+Shift+l     move right
    $mod+Shift+Left  move left
    $mod+Shift+Down  move down
    $mod+Shift+Up    move up
    $mod+Shift+Right move right

    # Move workspace to output.
    $mod+Ctrl+Shift+h     move workspace to output left
    $mod+Ctrl+Shift+j     move workspace to output down
    $mod+Ctrl+Shift+k     move workspace to output up
    $mod+Ctrl+Shift+l     move workspace to output right
    $mod+Ctrl+Shift+Left  move workspace to output left
    $mod+Ctrl+Shift+Down  move workspace to output down
    $mod+Ctrl+Shift+Up    move workspace to output up
    $mod+Ctrl+Shift+Right move workspace to output right

    # Window size
    $mod+f fullscreen toggle

    # Horizontal/vertical orientation switching
    $mod+bracketleft  split h
    $mod+bracketright split v

    # Change container layout (stacked, tabbed, toggle split)
    $mod+w layout tabbed
    $mod+e layout toggle split

    # Toggle tiling/floating
    $mod+t       floating toggle
    $mod+Shift+t sticky toggle

    # Focus the parent/child container.
    $mod+a focus parent

    # Focus between floating and split containers.
    $mod+Shift+Tab focus mode_toggle

    # Focus urgent window.
    $mod+u [urgent=latest] focus

    # Toggle between last used workspaces.
    $mod+Tab workspace back_and_forth

    # Switch to workspace.
    $mod+1 workspace $www
    $mod+2 workspace $code
    $mod+3 workspace $cmd
    $mod+4 workspace $chat
    $mod+5 workspace $media
    $mod+6 workspace $games
    $mod+7 workspace $misc

    # Move focused window to workspace.
    $mod+Shift+1 move container to workspace $www
    $mod+Shift+2 move container to workspace $code
    $mod+Shift+3 move container to workspace $cmd
    $mod+Shift+4 move container to workspace $chat
    $mod+Shift+5 move container to workspace $media
    $mod+Shift+6 move container to workspace $games
    $mod+Shift+7 move container to workspace $misc

    # Window manager.
    $mod+q            kill
    $mod+Shift+c      reload
    $mod+Shift+r      restart
    $mod+Shift+Delete exec $locker

    # Notification handling.
    $mod+x           exec $notify close
    $mod+Shift+x     exec $notify close-all
    $mod+grave       exec $notify history-pop
    $mod+Shift+grave exec $notify context

    --no-repeat {
        # Volume keys.
        XF86AudioRaiseVolume exec $mixer --change-volume +5
        XF86AudioLowerVolume exec $mixer --change-volume -5
        XF86AudioMute        exec $mixer --toggle-mute

        # Media keys.
        $mod+Ctrl+Up    exec $player stop
        $mod+Ctrl+Down  exec $player play-pause
        $mod+Ctrl+Left  exec $player previous
        $mod+Ctrl+Right exec $player next

        XF86AudioStop    exec $player stop
        XF86AudioPlay    exec $player play-pause
        XF86AudioPrev    exec $player previous
        XF86AudioNext    exec $player next
        XF86AudioRewind  exec $player position 10-
        XF86AudioForward exec $player position 10+

        XF86MonBrightnessDown exec brightnessctl set 10%-
        XF86MonBrightnessUp exec brightnessctl set +10%

        $mod+p       exec grim - | wl-copy --type image/png && notify-send "Screenshot Copied"
        $mod+Shift+p exec grim -g $(slurp -d) - | wl-copy --type image/png && notify-send "Screenshot Copied"
    }

    # Modes.
    $mod+r       mode $resize
    $mod+Shift+q mode $session
}

# ----------
# APPEARANCE
# ----------

# Default font.
font Iosevka 20
exec_always swaymsg font Iosevka $(echo 14 | awk '{printf "%.0f", $0 * ENVIRON["GDK_DPI_SCALE"]}')

# Wallpaper.
output * bg ~/.config/sway/default-bg fill

# Borders and gaps.
default_border          pixel 3
default_floating_border pixel 3
hide_edge_borders --i3  smart
gaps                    inner 10
smart_gaps              on

# Color names.
set {
    $background #282828
    $foreground #d8d8d8
    $focused    #2d2d2d
    $unfocused  #585858
    $urgent     #ab4642
}

# Window manager colors.
# Class                 Border      Background  Text        Indicator
client.focused          $background $background $foreground $focused
client.focused_inactive $background $background $unfocused  $focused
client.unfocused        $background $background $unfocused  $background
client.urgent           $urgent     $urgent     $background $urgent
client.background                   $background

# ---------------
# MODES & MODULES
# ---------------

# These bindings trigger as soon as you enter the resize mode.
mode $resize bindsym --to-code {
    k resize grow   up   10 px or 10 ppt
    j resize shrink up   10 px or 10 ppt
    h resize grow   left 10 px or 10 ppt
    l resize shrink left 10 px or 10 ppt

    # Same bindings, but for the arrow keys
    Up    resize grow   up   10 px or 10 ppt
    Down  resize shrink up   10 px or 10 ppt
    Left  resize grow   left 10 px or 10 ppt
    Right resize shrink left 10 px or 10 ppt

    # Back to normal mode: Enter or Escape
    Return mode "default"
    Escape mode "default"
}

mode $session bindsym --to-code {
    s exec systemctl suspend, mode "default"
    l exec swaymsg exit, mode "default"
    r exec systemctl reboot, mode "default"
    p exec systemctl poweroff -i, mode "default"

    # Back to normal mode: Enter or Escape
    Return mode "default"
    Escape mode "default"
}

bar {
    swaybar_command waybar
}

# ---------------
# MISC & INCLUDES
# ---------------

include ~/.config/sway/config.d/*
